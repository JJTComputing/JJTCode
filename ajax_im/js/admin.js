var AdminWindows={userSearch:function(){var A;if($("admin-userSearch")){Windows.getWindow("admin-userSearch").toFront();return }A=new Window({id:"admin-userSearch",className:"dialog",width:250,height:110,resizable:true,title:Languages.get("admin-admin")+" - "+Languages.get("admin-userSearch"),draggable:true,closable:true,maximizable:false,minimizable:true,detachable:false,minWidth:250,minHeight:110,showEffectOptions:{duration:0},hideEffectOptions:{duration:0}});A.setConstraint(true,{left:0,right:0,top:0,bottom:0});A.getContent().innerHTML='<div class="dialog_info" style="padding:3px;">'+Languages.get("admin-chooseByAndSearch")+'</div>                                               <div id="admin-userSearchBox">                                               <div style="display:block;float:left;margin-right:24px;padding:4px 0 0 5px;">'+Languages.get("admin-searchType")+':</div>                                               <select id="admin-searchType" name="adminSearchType" style="font-family:Tahoma,Verdana,Arial,sans-serif;">                                               <option selected="selected" value="username">'+Languages.get("username")+'</option>                                               <option value="email">'+Languages.get("email")+'</option>                                               </select><br />                                               <div style="display:block;float:left;margin-right:46px;padding:4px 0 0 5px;">'+Languages.get("search")+':</div>                                               <input type="text" id="admin-search" name="adminSearch" style="width:110px;" onkeypress="handleInput(event, function() { Admin.findUser($(\'admin-searchType\').value, $(\'admin-search\').value); })" />                                               <div id="admin-searchButtons">'+ButtonCtl.create(Languages.get("search"),"Admin.findUser($('admin-searchType').value, $('admin-search').value);")+ButtonCtl.create(Languages.get("cancel"),"Windows.close('admin-userSearch');")+"</div>";$("admin-searchButtons").setStyle({position:"absolute",top:"105px",left:"32px"});A.setDestroyOnClose();A.showCenter()},handleResize:function(A){switch(A.getId().replace(/admin-/,"")){case"userSearch":if($("admin-userSearchResults")){$("admin-userSearchResults").setStyle({width:A.getSize()["width"]+"px"});$("admin-userSearchResults").parentNode.setStyle({width:A.getSize()["width"]+"px"});$("admin-userExecFunctions").setStyle({left:((A.getSize()["width"]-$("admin-userExecFunctions").getWidth())/2)+"px"})}$("admin-searchButtons").setStyle({left:((A.getSize()["width"]-$("admin-searchButtons").getWidth())/2)+"px"});break}}};var Admin={selectedUser:null,findUser:function(B,C){var A=new XHConn();A.connect(adminPingTo,"POST","call=search&by="+B+"&for="+C,function(E){if(E.responseText=="access_denied"){return Admin.noAccess()}if($("admin-userSearchResults")){$("admin-userSearchResults").parentNode.parentNode.removeChild($("admin-userSearchResults").parentNode)}var I=E.responseText.parseJSON();var J='<table id="admin-userSearchResults" style="text-align:center;" class="listNotSelected">';J+='<thead><tr style="cursor:pointer;"><th>'+Languages.get("username")+"</th><th>"+Languages.get("email")+"</th><th>"+Languages.get("admin-lastKnownIP")+"</th><th>"+Languages.get("admin-lastActive")+"</th><th>"+Languages.get("admin-status")+"</th><th>"+Languages.get("admin-banned")+"</th><th>"+Languages.get("admin-admin")+"</th></tr></thead><tbody>";for(var H=0;H<I.length;H++){var D=new Date(I[H].lastActive*1000);var G=D.getMonth()+"/"+D.getDate()+"/"+D.getFullYear()+" @ "+D.getHours()+":"+D.getMinutes();J+='<tr style="cursor:pointer;" onmouseover="Admin.findUserListHover(this);" onmouseout="Admin.findUserListDefault(this);" onclick="Admin.findUserListSelect(this);"><td>'+I[H].username+"</td><td>"+I[H].email+"</td><td>"+I[H].lastKnownIP+"</td><td>"+G+"</td><td>"+I[H].currentStatus+"</td><td>"+I[H].banned+"</td><td>"+I[H].admin+"</td></tr>"}J+="</tbody></table>";var K=Windows.getWindow("admin-userSearch");K.setSize(500,232);K.options.minWidth=500;K.options.minHeight=232;K.showCenter(false);K.getContent().innerHTML+=J;if(!$("admin-userExecFunctions")){K.getContent().innerHTML+='<div id="admin-userExecFunctions">'+ButtonCtl.create(Languages.get("admin-kick"),"Admin.kickUser(Admin.selectedUser.getElementsByTagName('td')[0].innerHTML);")+ButtonCtl.create(Languages.get("admin-ban"),"Admin.banUser(Admin.selectedUser.getElementsByTagName('td')[0].innerHTML);","admin-banButton")+ButtonCtl.create(Languages.get("admin-makeAdmin"),"Admin.toggleAdmin(Admin.selectedUser.getElementsByTagName('td')[0].innerHTML);","admin-makeAdminButton")+"</div>";$("admin-userExecFunctions").setStyle({position:"absolute",top:"195px",left:"83px"})}$("admin-searchButtons").innerHTML=ButtonCtl.create(Languages.get("searchAgain"),"Admin.findUser($('admin-searchType').value, $('admin-search').value);")+ButtonCtl.create(Languages.get("cancel"),"Windows.close('admin-userSearch');");$("admin-searchButtons").setStyle({position:"absolute",top:"225px",left:"130px"});var F=new ScrollableTable($("admin-userSearchResults"),100,500);F=new SortableTable($("admin-userSearchResults"));$("admin-searchType").value=B;$("admin-search").value=C})},banUser:function(A){var B=new XHConn();B.connect(adminPingTo,"POST","call=ban&user="+A,function(C){if(C.responseText=="access_denied"){return Admin.noAccess()}Admin.selectedUser.getElementsByTagName("td")[4].innerHTML=C.responseText;$("admin-banButton").innerHTML=(C.responseText=="true"?Languages.get("admin-unban"):Languages.get("admin-ban"))})},kickUser:function(A){var B=new XHConn();B.connect(adminPingTo,"POST","call=kick&user="+A,function(C){if(C.responseText=="access_denied"){return Admin.noAccess()}Admin.selectedUser.getElementsByTagName("td")[3].innerHTML="0"})},toggleAdmin:function(A){var B=new XHConn();B.connect(adminPingTo,"POST","call=admin&user="+A,function(C){if(C.responseText=="access_denied"){return Admin.noAccess()}Admin.selectedUser.getElementsByTagName("td")[5].innerHTML=C.responseText;$("admin-makeAdminButton").innerHTML=(C.responseText=="true"?Languages.get("admin-removeAdmin"):Languages.get("admin-makeAdmin"))})},findUserListHover:function(A){Element.addClassName(A,"listHover").removeClassName("listSelected").removeClassName("listNotSelected")},findUserListDefault:function(A){if(A!=Admin.selectedUser){Element.addClassName(A,"listNotSelected").removeClassName("listSelected").removeClassName("listHover")}else{Element.addClassName(A,"listSelected").removeClassName("listNotSelected").removeClassName("listHover")}},findUserListSelect:function(A){if(Admin.selectedUser){Element.addClassName(Admin.selectedUser,"listNotSelected").removeClassName("listSelected").removeClassName("listHover")}Element.addClassName(A,"listSelected").removeClassName("listNotSelected").removeClassName("listHover");Admin.selectedUser=A;if(A.getElementsByTagName("td")[4].innerHTML=="true"){$("admin-banButton").innerHTML=Languages.get("admin-unban")}else{$("admin-banButton").innerHTML=Languages.get("admin-ban")}if(A.getElementsByTagName("td")[5].innerHTML=="true"){$("admin-makeAdminButton").innerHTML=Languages.get("admin-removeAdmin")}else{$("admin-makeAdminButton").innerHTML=Languages.get("admin-makeAdmin")}}};function ScrollableTable(tableEl,tableHeight,tableWidth){this.initIEengine=function(){this.containerEl.style.overflowY="auto";if(this.tableEl.parentElement.clientHeight-this.tableEl.offsetHeight<0){this.tableEl.style.width=this.newWidth-this.scrollWidth+"px"}else{this.containerEl.style.overflowY="hidden";this.tableEl.style.width=this.newWidth+"px"}if(this.thead){var trs=this.thead.getElementsByTagName("tr");for(x=0;x<trs.length;x++){trs[x].style.position="relative";trs[x].style.setExpression("top","this.parentElement.parentElement.parentElement.scrollTop + 'px'")}}if(this.tfoot){var trs=this.tfoot.getElementsByTagName("tr");for(x=0;x<trs.length;x++){trs[x].style.position="relative";trs[x].style.setExpression("bottom","(this.parentElement.parentElement.offsetHeight - this.parentElement.parentElement.parentElement.clientHeight - this.parentElement.parentElement.parentElement.scrollTop) + 'px'")}}eval("window.attachEvent('onresize', function () { document.getElementById('"+this.tableEl.id+"').style.visibility = 'hidden'; document.getElementById('"+this.tableEl.id+"').style.visibility = 'visible'; } )")};this.initFFengine=function(){this.containerEl.style.overflow="hidden";this.tableEl.style.width=this.newWidth+"px";var headHeight=(this.thead)?this.thead.clientHeight:0;var footHeight=(this.tfoot)?this.tfoot.clientHeight:0;var bodyHeight=this.tbody.clientHeight;var trs=this.tbody.getElementsByTagName("tr");if(bodyHeight>=(this.newHeight-(headHeight+footHeight))){this.tbody.style.overflow="-moz-scrollbars-vertical";for(x=0;x<trs.length;x++){var tds=trs[x].getElementsByTagName("td");tds[tds.length-1].style.paddingRight+=this.scrollWidth+"px"}}else{this.tbody.style.overflow="-moz-scrollbars-none"}var cellSpacing=(this.tableEl.offsetHeight-(this.tbody.clientHeight+headHeight+footHeight))/4;this.tbody.style.height=(this.newHeight-(headHeight+cellSpacing*2)-(footHeight+cellSpacing*2))+"px"};this.tableEl=tableEl;this.scrollWidth=16;this.originalHeight=this.tableEl.clientHeight;this.originalWidth=this.tableEl.clientWidth;this.newHeight=parseInt(tableHeight);this.newWidth=tableWidth?parseInt(tableWidth):this.originalWidth;this.tableEl.style.height="auto";this.tableEl.removeAttribute("height");this.containerEl=this.tableEl.parentNode.insertBefore(document.createElement("div"),this.tableEl);this.containerEl.appendChild(this.tableEl);this.containerEl.style.height=this.newHeight+"px";this.containerEl.style.width=this.newWidth+"px";var thead=this.tableEl.getElementsByTagName("thead");this.thead=(thead[0])?thead[0]:null;var tfoot=this.tableEl.getElementsByTagName("tfoot");this.tfoot=(tfoot[0])?tfoot[0]:null;var tbody=this.tableEl.getElementsByTagName("tbody");this.tbody=(tbody[0])?tbody[0]:null;if(!this.tbody){return }if(document.all&&document.getElementById&&!window.opera){this.initIEengine()}if(!document.all&&document.getElementById&&!window.opera){this.initFFengine()}}function SortableTable(A){this.tbody=A.getElementsByTagName("tbody");this.thead=A.getElementsByTagName("thead");this.tfoot=A.getElementsByTagName("tfoot");this.getInnerText=function(F){if(typeof (F.textContent)!="undefined"){return F.textContent}if(typeof (F.innerText)!="undefined"){return F.innerText}if(typeof (F.innerHTML)=="string"){return F.innerHTML.replace(/<[^<>]+>/g,"")}};this.getParent=function(G,F){if(G==null){return null}else{if(G.nodeType==1&&G.tagName.toLowerCase()==F.toLowerCase()){return G}else{return this.getParent(G.parentNode,F)}}};this.sort=function(F){var I=F.cellIndex;var J=this.getInnerText(this.tbody[0].rows[1].cells[I]);var H=this.sortCaseInsensitive;if(J.match(/\d\d[-]+\d\d[-]+\d\d\d\d/)){H=this.sortDate}if(J.replace(/^\s+|\s+$/g,"").match(/^[\d\.]+$/)){H=this.sortNumeric}this.sortColumnIndex=I;var G=new Array();for(j=0;j<this.tbody[0].rows.length;j++){G[j]=this.tbody[0].rows[j]}G.sort(H);if(F.getAttribute("sortdir")=="down"){G.reverse();F.setAttribute("sortdir","up")}else{F.setAttribute("sortdir","down")}for(C=0;C<G.length;C++){this.tbody[0].appendChild(G[C])}};this.sortCaseInsensitive=function(G,F){aa=B.getInnerText(G.cells[B.sortColumnIndex]).toLowerCase();bb=B.getInnerText(F.cells[B.sortColumnIndex]).toLowerCase();if(aa==bb){return 0}if(aa<bb){return -1}return 1};this.sortDate=function(G,F){aa=B.getInnerText(G.cells[B.sortColumnIndex]);bb=B.getInnerText(F.cells[B.sortColumnIndex]);date1=aa.substr(6,4)+aa.substr(3,2)+aa.substr(0,2);date2=bb.substr(6,4)+bb.substr(3,2)+bb.substr(0,2);if(date1==date2){return 0}if(date1<date2){return -1}return 1};this.sortNumeric=function(G,F){aa=parseFloat(B.getInnerText(G.cells[B.sortColumnIndex]));if(isNaN(aa)){aa=0}bb=parseFloat(B.getInnerText(F.cells[B.sortColumnIndex]));if(isNaN(bb)){bb=0}return aa-bb};var B=this;var D=this.thead;if(!(this.tbody&&this.tbody[0].rows&&this.tbody[0].rows.length>0)){return }if(D&&D[0].rows&&D[0].rows.length>0){var E=D[0].rows[0]}else{return }for(var C=0;C<E.cells.length;C++){E.cells[C].sTable=this;E.cells[C].onclick=function(){this.sTable.sort(this);return false}}};